<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.avg.lawsuitmanagement.schedule.repository.ScheduleMapperRepository">
    <select id="select"
      parameterType="com.avg.lawsuitmanagement.schedule.repository.param.ScheduleSelectParam"
      resultType="com.avg.lawsuitmanagement.schedule.dto.ScheduleRawDto">
        SELECT r.id           `reception_id`,
               r.deadline     `deadline`,
               l.id           `lawsuit_id`,
               l.lawsuit_type `lawsuit_type`,
               l.name         `lawsuit_name`,
               m.name         `employee_name`
        FROM reception r
                 JOIN lawsuit l ON r.lawsuit_id = l.id
                 JOIN lawsuit_member_map map ON l.id = map.lawsuit_id
                 JOIN member m ON m.id = map.member_id
        WHERE r.is_deleted = false
          AND deadline >= #{startDeadline}
          AND #{endDeadline} >= deadline
    </select>

    <select id="selectInfo"
      parameterType="java.lang.Long"
      resultType="com.avg.lawsuitmanagement.schedule.dto.ScheduleInfoRawDto">
        SELECT l.id             `lawsuit_id`,
               l.lawsuit_num    `lawsuit_num`,
               l.name           `lawsuit_name`,
               l.lawsuit_type   `lawsuit_type`,
               l.commission_fee `lawsuit_commission_fee`,
               l.contingent_fee `lawsuit_contingent_fee`,
               m.id             `member_id`,
               m.name           `member_name`,
               c.id             `client_id`,
               c.name           `client_name`,
               r.id             `reception_id`,
               r.status         `reception_status`,
               r.category       `reception_category`,
               r.contents       `reception_contents`,
               r.received_at    `reception_received_at`,
               r.deadline       `reception_deadline`
        FROM lawsuit l
                 JOIN reception r ON l.id = r.lawsuit_id
                 JOIN lawsuit_member_map lm ON l.id = lm.lawsuit_id
                 JOIN lawsuit_client_map lc ON l.id = lc.lawsuit_id
                 JOIN member m ON lm.member_id = m.id
                 JOIN client c ON lc.client_id = c.id
        WHERE l.is_deleted = false
          AND r.id = #{receptionId}
    </select>
</mapper>