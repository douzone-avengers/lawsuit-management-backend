<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.avg.lawsuitmanagement.file.repository.FileMapperRepository">
    <!-- originFileName에 해당하는 파일 가져오는 쿼리 -->
    <select id="selectFileByOriginFileName" resultType="com.avg.lawsuitmanagement.file.dto.FileMetaDto">
        select *
        from file
        where origin_filename = #{originFileName} and is_deleted = false
    </select>

    <!-- 파일id에 해당하는 파일 가져오는 쿼리 -->
    <select id="selectFileById" resultType="com.avg.lawsuitmanagement.file.dto.FileMetaDto">
        select *
        from file
        where id = #{fileId} and is_deleted = false
    </select>

    <!-- 지출id에 해당하는 파일id 리스트 가져오는 쿼리 -->
    <select id="selectFileIdListByExpenseId" parameterType="java.lang.Long">
        select file_id
        from expense_file_map
        where expense_id = #{expenseId}
        and is_deleted = false
    </select>

    <!-- 파일id 리스트에 해당하는 파일 리스트 가져오는 쿼리 -->
    <select id="selectFileInfoListById" parameterType="java.util.List">
        select *
        from file
        where is_deleted = false
        and id in
        <foreach item="item" index="index" collection="fileIdList" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <!-- 파일 등록 -->
    <insert id="insertFile" parameterType="com.avg.lawsuitmanagement.file.repository.param.FileInsertParam">
        insert into file (show_filename, origin_filename, path, extension)
        values (#{showFileName}, #{originFileName}, #{path}, #{extension})
    </insert>

    <!-- 파일 삭제 -->
    <update id="deleteFile" parameterType="java.lang.Long">
        update file
        set is_deleted = true
        where id = #{fileId}
        and is_deleted = false
    </update>
</mapper>