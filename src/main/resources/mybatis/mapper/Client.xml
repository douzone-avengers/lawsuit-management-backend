<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.avg.lawsuitmanagement.client.repository.ClientMapperRepository">

    <select id="selectClientById" parameterType="java.lang.Long">
        select *
        from client
        where id = #{clientId} and is_deleted = false;
    </select>

    <select id="selectClientByEmail" parameterType="java.lang.String">
        select *
        from client
        where email = #{email} and is_deleted = false;
    </select>

    <insert id="insertClient" parameterType="InsertClientParam">
        insert into client (email, name, phone, address)
        values (#{email}, #{name}, #{phone}, #{address});
    </insert>

    <update id="updateClientMemberId" parameterType="UpdateClientMemberIdParam">
        update client
        set member_id = #{memberId}
        where id = #{clientId};
    </update>

    <update id="updateClientInfo" parameterType="UpdateClientInfoParam">
        update client
        set email = #{email}, name = #{name}, phone = #{phone}, address = #{address}
        where id = #{clientId};
    </update>

    <update id="deleteClientInfo" parameterType="java.lang.Long">
        update client
        set is_deleted = true
        where id = #{clientId};
    </update>

    <select id="getClientList">
        select *
        from client
        where is_deleted = false;
    </select>

    <select id="getLawsuitCountByClientId" parameterType="java.lang.Long" resultType="java.lang.Long">
        select count(*)
        from lawsuit l
                 join lawsuit_client_map map on l.id = map.lawsuit_id
        where map.client_id = #{clientId}
          and l.is_deleted = false
    </select>

    <select id="selectClientLawsuitList" parameterType="SelectClientLawsuitListParam" resultType="LawsuitDto">
        select l.*
        from lawsuit l
                 join lawsuit_client_map map on l.id = map.lawsuit_id
        where map.client_id = #{clientId}
          and l.is_deleted = false
        order by l.created_at desc
            limit #{limit} offset #{offset}
    </select>

    <select id="selectClientListById" parameterType="java.util.List">
        select *
        from client
        where #{clientId} in
        <foreach item="item" index="index" collection="clientId" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>
</mapper>